services:
  content-service:
    image: adebayoyeleye/story-content-service:${CONTENT_IMAGE_TAG}
    env_file:
      - .env
    environment:
      SPRING_PROFILES_ACTIVE: prod
      SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK_SET_URI: http://auth-service:8081/.well-known/jwks.json
      SERVER_PORT: ${CONTENT_SERVER_PORT}
      SPRING_MONGODB_URI: ${CONTENT_MONGODB_URI}
    restart: always
    depends_on:
      - auth-service

  auth-service:
    image: adebayoyeleye/auth-service:${AUTH_IMAGE_TAG}
    env_file:
      - .env
    environment:
      SPRING_PROFILES_ACTIVE: prod
      SERVER_PORT: ${AUTH_SERVER_PORT}
      SPRING_MONGODB_URI: ${AUTH_MONGODB_URI}
    restart: always

  frontend:
    image: adebayoyeleye/story-frontend:${FRONTEND_IMAGE_TAG}
    restart: always

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./infra/nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - content-service
      - auth-service
      - frontend
    restart: always
